

Repositório de APT HOWTO


** Ingredientes

- 1 máquina com acesso rápido à rede e bastante largura de banda
- 1 servidor de ftp (anônimo) ou http rodando

** Modo de Preparo

1) Vá ao diretório raiz do servidor de ftp/http
2) Crie a seguinte estrutura de diretórios nele:

<versao>/SRPMS/
<versao>/conectiva/RPMS.<comp1>/
<versao>/conectiva/RPMS.<comp2>/
            ...
<versao>/conectiva/RPMS.<compn>/
<versao>/conectiva/base/

Você pode substituir <versao> pela versão da distribuição
que será disponibilizada ou se você estiver disponibilizando
algum outro software, a versão da distribuição a que se destinam
os pacotes.

<comp1>...<compn> são os diretórios dos componentes da distribuição
e podem ser qualquer string. 

No diretório SRPMS devem estar contidos os srpms dos pacotes
do repositório.

3) Crie os arquivos de índice do apt (os pkglists) no diretório base.
Para isso, vá ao diretório base e execute o seguinte comando para
cada componente:

genpkglist <path>/<versao> <comp>

Onde:

<path>/<versao> é o caminho completo até o topo do diretório onde
está o repositório

<comp> é o nome do componente. 

Repita a operação para cada um dos componentes que você criou.

4) Comprima os arquivos de índice com gzip.

5) Distribua a linha do sources.list para o seu repositório. Ela
tem o seguinte formato:

rpm URL/<path> <versao>/conectiva <comp1> <comp2> ... <compn>
 ^      ^              ^              ^      ^      ^     ^ 
 |      |              |              +------+------+-----+- Nomes dos 
 |      |              |                                     componentes
 | 	|	       |
 |      |              versao da distribuição e nome da distribuição
 |      |
 |      URL para o diretório raiz do repositório
 |
 Tipo de distribuição. No caso, rpm

** Exemplos:

## Quer se fazer um repositório de pacotes para o Conectiva 6.0, na máquina
repo.conectiva.com.br, usando http:

cd /home/httpd
mkdir -p coisas/6.0
cd coisas/6.0
mkdir SRPMS
mkdir -p conectiva/RPMS.bla
mkdir -p conectiva/base
cp /meus/pacotes/*src.rpm SRPMS
cp /meus/pacotes/*i386.rpm conectiva/RPMS.bla
cd conectiva/base
genpkglist /home/httpd/coisas/6.0/conectiva bla
gzip pkglist.bla

Em sources.list deve se adicionar:

rpm http://repo.conectiva.com.br/coisas 6.0/conectiva bla


## Quer se fazer um repositório de pacotes para a distribuição RedRat 20.0,
em bla.redrat.com, usando ftp:

cd /home/ftp/pub
mkdir -p stuff/20.0
cd stuff/20.0
mkdir SRPMS
mkdir -p redrat/RPMS.1
mkdir -p redrat/RPMS.2
mkdir -p redrat/base
cp /tmp/pacotes*src.rpm SRPMS
cp <bla bla bla> redrat/RPMS.1
cp <bla bla bla> redrat/RPMS.2
cd redrat/base
genpkglist /home/ftp/stuff/20.0/redrat 1
genpkglist /home/ftp/stuff/20.0/redrat 2
gzip pkglist.1
gzip pkglist.2

Em sources.list deve se adicionar:

rpm ftp://bla.redrat.com/pub/stuff 20.0/redrat 1 2









